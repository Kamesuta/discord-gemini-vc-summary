# 要件定義書

## 概要

この機能は、ボイスチャンネルに参加し、音声会話を録音して、Google Gemini APIを使用して要約を生成するDiscord botを作成することです。このbotは、ユーザーにボイスチャットセッションの簡潔な要約を提供し、見逃した会話に追いつくことや、重要な議論のポイントを確認することを容易にします。

## 要件

### 要件1

**ユーザーストーリー:** Discordサーバー管理者として、音声会話を要約できるbotをサーバーに招待したい。これにより、メンバーが見逃した議論の概要を素早く把握できるようになる。

#### 受け入れ基準

1. botがDiscordサーバーに招待された時、botは適切な権限でサーバーメンバーリストに表示される
2. botはconfig.tomlファイルから設定を読み込んで動作する

### 要件2

**ユーザーストーリー:** Discordユーザーとして、botが自動的にボイスチャンネルに参加して会話を監視してほしい。これにより、手動でbotを呼ぶ必要がなくなる。

#### 受け入れ基準

1. マイクをミュートしていないユーザーが設定された人数（デフォルト3人）以上になった時、botは自動的にボイスチャンネルに参加する
2. botが参加するのは、config.tomlで許可されたVCカテゴリ内のチャンネルのみである
3. config.tomlの拒否VCチャンネルリストに含まれるチャンネルには参加しない
4. botがボイスチャンネルに参加した時、botはすべての参加者からの音声録音を開始する
5. ユーザーがボイスチャンネルに参加または退出した時、botは録音をシームレスに継続する
6. すべてのユーザーがボイスチャンネルから退出した時、botも自動的に退出する
7. botはユーザーごとに個別に音声を録音し、ユーザーごとに無音期間を検知してセグメント分けを行う

### 要件3

**ユーザーストーリー:** Discordユーザーとして、現在または最近のボイス会話の要約を要求したい。これにより、何が議論されたかを素早く理解できるようになる。

#### 受け入れ基準

1. ユーザーが要約を要求した時、botはGoogle Gemini APIを使用して録音された音声を処理する
2. 音声処理が完了した時、botは重要なポイントとトピックを含む構造化された要約を生成する
3. 要約が準備できた時、botは指定されたテキストチャンネルに投稿するか、ユーザーに応答する
4. 音声が長すぎる場合、botはそれをセグメントに分割して包括的な要約を提供する

### 要件4

**ユーザーストーリー:** Discordサーバーメンバーとして、botが定期的に要約を提供し、新規参加者に「今北三行」を提供してほしい。これにより、会話の流れを把握しやすくなる。

#### 受け入れ基準

1. 設定された間隔（デフォルト1分）で、botは要約チャンネルに定期的な要約を投稿する
2. 新しいユーザーがボイスチャンネルに参加した時、botは「今北三行」メッセージをVCのテキストチャンネルに投稿する
3. 「今北三行」メッセージには現在の活動内容（マイクラ、技術的な話など）を含める
4. botは短期的要約（直近の会話）と中期的要約（より長い期間の流れ）を管理する
5. botは長期的なメモリーを維持して、継続的な文脈を把握する
6. 会話内容が不十分だった場合、botは不要な要約を生成しない

### 要件5

**ユーザーストーリー:** Discordサーバー管理者として、config.tomlファイルでbotの動作を設定したい。これにより、サーバーのニーズに適切に機能するようになる。

#### 受け入れ基準

1. config.tomlファイルで自動参加の最小ユーザー数を設定できる
2. config.tomlファイルで許可するVCカテゴリを指定できる
3. config.tomlファイルで拒否するVCチャンネルリストを指定できる
4. config.tomlファイルで要約を投稿するテキストチャンネルを指定できる
5. config.tomlファイルで定期要約の間隔（デフォルト1分）を設定できる
6. botがエラーに遭遇した時、botは適切にログを記録する
7. API制限に達した場合、botは適切に処理し、一時的な利用不可をユーザーに通知する

### 要件6

**ユーザーストーリー:** Discordユーザーとして、音声要約botを使用する際にプライバシーについて適切に通知されたい。これにより、録音されていることを認識できるようになる。

#### 受け入れ基準

1. 「今北三行」メッセージに「-# ※VCの音声は要約生成に使用されます」という注意書きを含める
2. 音声データが処理される時、botは処理に必要な期間を超えて生の音声を保存しない